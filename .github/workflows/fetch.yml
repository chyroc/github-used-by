name: fetch

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  schedule:
    - cron: "0 0 * * *"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.17

    - name: Run
      run: |
        cd cmd/fetch-used-by && go build -o /tmp/fetch-used-by main.go
        cd cmd/generate-badge && go build -o /tmp/generate-badge main.go

    - name: Run
      run: |
        git checkout gh-pages || git checkout -b gh-pages
        /tmp/fetch-used-by
        /tmp/generate-badge

    - name: Commit and Push
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email '41898282+github-actions[bot]@users.noreply.github.com'
        git add --all
        git commit -am "Automated Commit: $(date)" || echo "no commit"
        git push || echo "no push"
